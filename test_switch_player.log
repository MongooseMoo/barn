============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Q\code\cow_py\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Q\code\cow_py
configfile: pyproject.toml
collecting ... collected 1479 items / 1465 deselected / 14 selected

tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::requires_two_arguments] PASSED [  7%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::requires_two_arguments_not_one] PASSED [ 14%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::first_arg_must_be_object] SKIPPED [ 21%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::second_arg_must_be_object] SKIPPED [ 28%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::third_arg_must_be_int_if_provided] SKIPPED [ 35%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::non_wizard_gets_E_PERM] FAILED [ 42%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::programmer_cannot_switch_player] FAILED [ 50%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::cannot_switch_player_to_itself] PASSED [ 57%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::old_player_must_be_connected] PASSED [ 64%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::new_player_must_be_valid_user] PASSED [ 71%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::new_player_must_have_player_flag] PASSED [ 78%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::accepts_silent_flag_true] PASSED [ 85%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::accepts_silent_flag_false] PASSED [ 92%]
tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::wizard_can_call_switch_player] PASSED [100%]

================================== FAILURES ===================================
____ TestConformance.test_yaml_case[switch_player::non_wizard_gets_E_PERM] ____

self = <tests.conformance.test_conformance.TestConformance object at 0x000001521BA1A1C0>
runner = <tests.conformance.runner.YamlTestRunner object at 0x000001521B51C440>
yaml_test_case = (MooTestSuite(name='switch_player', description='Tests for switch_player() builtin function', version='1.0', skip=Fals...', type=None, match=None, contains=None, range=None, satisfies=None, notifications=None), cleanup=[], timeout_ms=5000))

    def test_yaml_case(self, runner: YamlTestRunner, yaml_test_case: tuple[MooTestSuite, MooTestCase]):
        """Run a single YAML test case.
    
        This method is called once for each test case defined in YAML files.
        The yaml_test_case fixture is parametrized by conftest.pytest_generate_tests.
        """
        suite, test = yaml_test_case
    
        # Handle skip
        if test.skip:
            reason = test.skip if isinstance(test.skip, str) else "Skipped"
            pytest.skip(reason)
    
        # Handle skip_if condition
        if test.skip_if:
            if self._evaluate_skip_condition(test.skip_if):
                pytest.skip(f"Skipped due to: {test.skip_if}")
    
        # Run suite setup if defined (only runs once per suite)
        runner.run_suite_setup(suite)
    
        # Run the test
>       runner.run_test(test)

tests\conformance\test_conformance.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests\conformance\runner.py:96: in run_test
    self._verify_expectations(test, result)
tests\conformance\runner.py:226: in _verify_expectations
    self._verify_error(expect.error, result, test.name)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <tests.conformance.runner.YamlTestRunner object at 0x000001521B51C440>
expected_error = 'E_PERM'
result = ExecutionResult(success=True, value=0, error=None, error_message=None, notifications=[], logs=[])
test_name = 'non_wizard_gets_E_PERM'

    def _verify_error(self, expected_error: str, result: ExecutionResult, test_name: str) -> None:
        """Verify that an error was returned."""
        if result.success:
>           raise AssertionError(
                f"Test '{test_name}' expected error {expected_error}, "
                f"but got success with value: {result.value!r}"
            )
E           tests.conformance.runner.AssertionError: Test 'non_wizard_gets_E_PERM' expected error E_PERM, but got success with value: 0

tests\conformance\runner.py:263: AssertionError
_ TestConformance.test_yaml_case[switch_player::programmer_cannot_switch_player] _

self = <tests.conformance.test_conformance.TestConformance object at 0x000001521BA1A210>
runner = <tests.conformance.runner.YamlTestRunner object at 0x000001521B51C440>
yaml_test_case = (MooTestSuite(name='switch_player', description='Tests for switch_player() builtin function', version='1.0', skip=Fals...', type=None, match=None, contains=None, range=None, satisfies=None, notifications=None), cleanup=[], timeout_ms=5000))

    def test_yaml_case(self, runner: YamlTestRunner, yaml_test_case: tuple[MooTestSuite, MooTestCase]):
        """Run a single YAML test case.
    
        This method is called once for each test case defined in YAML files.
        The yaml_test_case fixture is parametrized by conftest.pytest_generate_tests.
        """
        suite, test = yaml_test_case
    
        # Handle skip
        if test.skip:
            reason = test.skip if isinstance(test.skip, str) else "Skipped"
            pytest.skip(reason)
    
        # Handle skip_if condition
        if test.skip_if:
            if self._evaluate_skip_condition(test.skip_if):
                pytest.skip(f"Skipped due to: {test.skip_if}")
    
        # Run suite setup if defined (only runs once per suite)
        runner.run_suite_setup(suite)
    
        # Run the test
>       runner.run_test(test)

tests\conformance\test_conformance.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests\conformance\runner.py:96: in run_test
    self._verify_expectations(test, result)
tests\conformance\runner.py:226: in _verify_expectations
    self._verify_error(expect.error, result, test.name)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <tests.conformance.runner.YamlTestRunner object at 0x000001521B51C440>
expected_error = 'E_PERM'
result = ExecutionResult(success=False, value=None, error=<MooError.E_INVARG: 'E_INVARG'>, error_message=None, notifications=[], logs=[])
test_name = 'programmer_cannot_switch_player'

    def _verify_error(self, expected_error: str, result: ExecutionResult, test_name: str) -> None:
        """Verify that an error was returned."""
        if result.success:
            raise AssertionError(
                f"Test '{test_name}' expected error {expected_error}, "
                f"but got success with value: {result.value!r}"
            )
    
        if result.error is None:
            raise AssertionError(
                f"Test '{test_name}' expected error {expected_error}, "
                f"but got non-MOO error: {result.error_message}"
            )
    
        # Compare error codes
        actual_error = result.error.value if isinstance(result.error, MooError) else str(result.error)
        if actual_error != expected_error:
>           raise AssertionError(
                f"Test '{test_name}' expected error {expected_error}, "
                f"but got {actual_error}"
            )
E           tests.conformance.runner.AssertionError: Test 'programmer_cannot_switch_player' expected error E_PERM, but got E_INVARG

tests\conformance\runner.py:277: AssertionError
=========================== short test summary info ===========================
FAILED tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::non_wizard_gets_E_PERM]
FAILED tests/conformance/test_conformance.py::TestConformance::test_yaml_case[switch_player::programmer_cannot_switch_player]
=========== 2 failed, 9 passed, 3 skipped, 1465 deselected in 0.69s ===========
